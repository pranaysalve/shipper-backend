{"version":3,"file":"Input.mjs","sources":["../../../../../../../admin/src/pages/EditView/components/FormInputs/Component/Input.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { InputProps, useField } from '@strapi/admin/strapi-admin';\nimport { Field, Flex, IconButton } from '@strapi/design-system';\nimport { Trash } from '@strapi/icons';\nimport { useIntl } from 'react-intl';\n\nimport { useDocumentContext } from '../../../../../features/DocumentContext';\nimport { EditFieldLayout } from '../../../../../hooks/useDocumentLayout';\nimport { getTranslation } from '../../../../../utils/translations';\nimport { transformDocument } from '../../../utils/data';\nimport { createDefaultForm } from '../../../utils/forms';\nimport { type InputRendererProps } from '../../InputRenderer';\n\nimport { Initializer } from './Initializer';\nimport { NonRepeatableComponent } from './NonRepeatable';\nimport { RepeatableComponent } from './Repeatable';\n\ninterface ComponentInputProps\n  extends Omit<Extract<EditFieldLayout, { type: 'component' }>, 'size' | 'hint'>,\n    Pick<InputProps, 'hint'> {\n  labelAction?: React.ReactNode;\n  children: (props: InputRendererProps) => React.ReactNode;\n  /**\n   * We need layout to come from the props, and not via a hook, because Content History needs\n   * a way to modify the normal component layout to add hidden fields.\n   */\n  layout: EditFieldLayout[][];\n}\n\nconst ComponentInput = ({\n  label,\n  required,\n  name,\n  attribute,\n  disabled,\n  labelAction,\n  ...props\n}: ComponentInputProps) => {\n  const { formatMessage } = useIntl();\n  const field = useField(name);\n\n  const showResetComponent = !attribute.repeatable && field.value && !disabled;\n\n  const components = useDocumentContext('ComponentInput', (state) => state.document.components);\n\n  const handleInitialisationClick = () => {\n    const schema = components[attribute.component];\n    const form = createDefaultForm(schema, components);\n    const data = transformDocument(schema, components)(form);\n\n    field.onChange(name, data);\n  };\n\n  return (\n    <Field.Root error={field.error} required={required}>\n      <Flex justifyContent=\"space-between\">\n        <Field.Label action={labelAction}>\n          {label}\n          {attribute.repeatable && (\n            <>&nbsp;({Array.isArray(field.value) ? field.value.length : 0})</>\n          )}\n        </Field.Label>\n\n        {showResetComponent && (\n          <IconButton\n            label={formatMessage({\n              id: getTranslation('components.reset-entry'),\n              defaultMessage: 'Reset Entry',\n            })}\n            variant=\"ghost\"\n            onClick={() => {\n              field.onChange(name, null);\n            }}\n          >\n            <Trash />\n          </IconButton>\n        )}\n      </Flex>\n      {/**\n       * if the field isn't repeatable then we display a button to start the field\n       * TODO: should this just live in the `NonRepeatableComponent`?\n       */}\n      {!attribute.repeatable && !field.value && (\n        <Initializer disabled={disabled} name={name} onClick={handleInitialisationClick} />\n      )}\n      {!attribute.repeatable && field.value ? (\n        <NonRepeatableComponent attribute={attribute} name={name} disabled={disabled} {...props}>\n          {props.children}\n        </NonRepeatableComponent>\n      ) : null}\n      {attribute.repeatable && (\n        <RepeatableComponent attribute={attribute} name={name} disabled={disabled} {...props}>\n          {props.children}\n        </RepeatableComponent>\n      )}\n      <Field.Error />\n    </Field.Root>\n  );\n};\n\nconst MemoizedComponentInput = React.memo(ComponentInput);\n\nexport { MemoizedComponentInput as ComponentInput };\nexport type { ComponentInputProps };\n"],"names":["ComponentInput","label","required","name","attribute","disabled","labelAction","props","formatMessage","useIntl","field","useField","showResetComponent","repeatable","value","components","useDocumentContext","state","document","handleInitialisationClick","schema","component","form","createDefaultForm","data","transformDocument","onChange","_jsxs","Field","Root","error","Flex","justifyContent","Label","action","_Fragment","Array","isArray","length","_jsx","IconButton","id","getTranslation","defaultMessage","variant","onClick","Trash","Initializer","NonRepeatableComponent","children","RepeatableComponent","Error","MemoizedComponentInput","React","memo"],"mappings":"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"}