{"version":3,"file":"DocumentContext.mjs","sources":["../../../admin/src/features/DocumentContext.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { createContext } from '@strapi/admin/strapi-admin';\n\nimport { useDocument, type UseDocument } from '../hooks/useDocument';\nimport { buildValidParams } from '../utils/api';\n\ninterface DocumentMeta {\n  /**\n   * The equivalent of the \":id\" url param value\n   * i.e. gus5a67jcboa3o2zjnz39mb1\n   */\n  documentId: string;\n  /**\n   * The equivalent of the url \":slug\" param value\n   * i.e. api::articles.article\n   */\n  model: string;\n  /**\n   * The equivalent of the url \":collectionType\" param value\n   * i.e. collection-types or single-types\n   */\n  collectionType: string;\n  /**\n   * Query params object\n   * i.e. { locale: 'fr' }\n   */\n  params?: Record<string, string | string[] | null>;\n}\n\ninterface DocumentContextValue {\n  rootDocumentMeta: DocumentMeta;\n  document: ReturnType<UseDocument>;\n  meta: DocumentMeta;\n  changeDocument: (newRelation: DocumentMeta) => void;\n  documentHistory: DocumentMeta[];\n  setDocumentHistory: React.Dispatch<React.SetStateAction<DocumentMeta[]>>;\n  onPreview?: () => void;\n}\n\nconst [DocumentProvider, useDocumentContext] =\n  createContext<DocumentContextValue>('DocumentContext');\n\n/**\n * TODO: Document in contributor docs, Add unit test\n *\n * This context provider and its associated hook are used to access a document at its root level\n * and expose a function to change the current document being viewed to one of the root level docuemnt's relations.\n *\n * The useDocumentContext hook exposes:\n * - meta: information about the currentDocument,\n * - document: the actual document,\n * - changeDocument: a function to change the current document to one of its relations.\n * - rootDocumentMeta: information about the root level document (current page)\n */\nconst DocumentContextProvider = ({\n  children,\n  initialDocument,\n  onPreview,\n}: {\n  children: React.ReactNode | React.ReactNode[];\n  initialDocument: DocumentMeta;\n  onPreview?: () => void;\n}) => {\n  /**\n   * Initialize with the \"root\" document and expose a setter method to change to\n   * one of the root level document's relations.\n   */\n  const [currentDocumentMeta, changeDocument] = React.useState<DocumentMeta>(initialDocument);\n  const params = React.useMemo(\n    () => buildValidParams(currentDocumentMeta.params ?? {}),\n    [currentDocumentMeta.params]\n  );\n  const document = useDocument({ ...currentDocumentMeta, params });\n\n  const [documentHistory, setDocumentHistory] = React.useState<DocumentMeta[]>([]);\n\n  return (\n    <DocumentProvider\n      changeDocument={changeDocument}\n      document={document}\n      rootDocumentMeta={{\n        documentId: initialDocument.documentId,\n        model: initialDocument.model,\n        collectionType: initialDocument.collectionType,\n      }}\n      meta={currentDocumentMeta}\n      documentHistory={documentHistory}\n      setDocumentHistory={setDocumentHistory}\n      onPreview={onPreview}\n    >\n      {children}\n    </DocumentProvider>\n  );\n};\n\nexport { useDocumentContext, DocumentContextProvider };\nexport type { DocumentMeta };\n"],"names":["DocumentProvider","useDocumentContext","createContext","DocumentContextProvider","children","initialDocument","onPreview","currentDocumentMeta","changeDocument","React","useState","params","useMemo","buildValidParams","document","useDocument","documentHistory","setDocumentHistory","_jsx","rootDocumentMeta","documentId","model","collectionType","meta"],"mappings":";;;;;;AAwCA,MAAM,CAACA,gBAAAA,EAAkBC,kBAAmB,CAAA,GAC1CC,aAAoC,CAAA,iBAAA;AAEtC;;;;;;;;;;;IAYA,MAAMC,0BAA0B,CAAC,EAC/BC,QAAQ,EACRC,eAAe,EACfC,SAAS,EAKV,GAAA;AACC;;;AAGC,MACD,MAAM,CAACC,mBAAAA,EAAqBC,eAAe,GAAGC,KAAAA,CAAMC,QAAQ,CAAeL,eAAAA,CAAAA;IAC3E,MAAMM,MAAAA,GAASF,KAAMG,CAAAA,OAAO,CAC1B,IAAMC,iBAAiBN,mBAAoBI,CAAAA,MAAM,IAAI,EACrD,CAAA,EAAA;AAACJ,QAAAA,mBAAAA,CAAoBI;AAAO,KAAA,CAAA;AAE9B,IAAA,MAAMG,WAAWC,WAAY,CAAA;AAAE,QAAA,GAAGR,mBAAmB;AAAEI,QAAAA;AAAO,KAAA,CAAA;AAE9D,IAAA,MAAM,CAACK,eAAiBC,EAAAA,kBAAAA,CAAmB,GAAGR,KAAMC,CAAAA,QAAQ,CAAiB,EAAE,CAAA;AAE/E,IAAA,qBACEQ,GAAClB,CAAAA,gBAAAA,EAAAA;QACCQ,cAAgBA,EAAAA,cAAAA;QAChBM,QAAUA,EAAAA,QAAAA;QACVK,gBAAkB,EAAA;AAChBC,YAAAA,UAAAA,EAAYf,gBAAgBe,UAAU;AACtCC,YAAAA,KAAAA,EAAOhB,gBAAgBgB,KAAK;AAC5BC,YAAAA,cAAAA,EAAgBjB,gBAAgBiB;AAClC,SAAA;QACAC,IAAMhB,EAAAA,mBAAAA;QACNS,eAAiBA,EAAAA,eAAAA;QACjBC,kBAAoBA,EAAAA,kBAAAA;QACpBX,SAAWA,EAAAA,SAAAA;AAEVF,QAAAA,QAAAA,EAAAA;;AAGP;;;;"}